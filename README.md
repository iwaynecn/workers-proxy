# Cloudflare Worker ç®€æ˜“åå‘ä»£ç† (Simple Reverse Proxy)

è¿™æ˜¯ä¸€ä¸ªåŸºäº Cloudflare Workers çš„è½»é‡çº§åå‘ä»£ç†è„šæœ¬ã€‚å®ƒå…è®¸ä½ é€šè¿‡ Cloudflare çš„è¾¹ç¼˜ç½‘ç»œä»£ç†è®¿é—®ä»»æ„åç«¯æœåŠ¡å™¨ï¼ˆHTTP æˆ– HTTPSï¼‰ï¼Œå¹¶ä¸”æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡åŠ¨æ€é…ç½®åç«¯åœ°å€ï¼Œæ— éœ€ä¿®æ”¹ä»£ç å³å¯åˆ‡æ¢ç›®æ ‡ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- **é›¶é…ç½®ä»£ç **ï¼šæ‰€æœ‰é…ç½®å‡é€šè¿‡ç¯å¢ƒå˜é‡å®Œæˆï¼Œä»£ç é€šç”¨ã€‚
- **å…¨åè®®æ”¯æŒ**ï¼šæ”¯æŒåç«¯ä¸º HTTP æˆ– HTTPS åè®®ã€‚
- **ç«¯å£ä¿ç•™**ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶ä¿ç•™åç«¯åœ°å€ä¸­çš„éæ ‡å‡†ç«¯å£ï¼ˆå¦‚ `http://1.2.3.4:5000`ï¼‰ã€‚
- **è·¯å¾„é€ä¼ **ï¼šå®Œæ•´çš„è·¯å¾„ï¼ˆPathï¼‰å’ŒæŸ¥è¯¢å‚æ•°ï¼ˆQuery Stringï¼‰è½¬å‘ã€‚
- **Host å¤´ä¿®æ­£**ï¼šè‡ªåŠ¨é‡å†™ `Host` å¤´ï¼Œé˜²æ­¢åç«¯å› åŸŸåä¸åŒ¹é…æ‹’ç»è®¿é—®ã€‚
- **çœŸå® IP ä¼ é€’**ï¼šé€šè¿‡ `X-Forwarded-Host` ä¼ é€’åŸå§‹è®¿é—®åŸŸåã€‚

## ğŸ› ï¸ éƒ¨ç½²æŒ‡å—

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»º Worker

1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)ã€‚
2. è¿›å…¥ **Workers & Pages** é¡µé¢ã€‚
3. ç‚¹å‡» **Create Application** -> **Create Worker**ã€‚
4. ç»™ Worker èµ·ä¸ªåå­—ï¼ˆä¾‹å¦‚ `my-proxy`ï¼‰ï¼Œç‚¹å‡» **Deploy**ã€‚

### ç¬¬äºŒæ­¥ï¼šéƒ¨ç½²ä»£ç 

1. ç‚¹å‡» **Edit code** è¿›å…¥åœ¨çº¿ç¼–è¾‘å™¨ã€‚
2. å°† `worker.js` ä¸­çš„ä»£ç å®Œæ•´å¤åˆ¶å¹¶è¦†ç›–ç¼–è¾‘å™¨ä¸­çš„é»˜è®¤ä»£ç ã€‚
3. ç‚¹å‡»å³ä¸Šè§’çš„ **Deploy** ä¿å­˜ä»£ç ã€‚

### ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®åç«¯åœ°å€ï¼ˆå…³é”®ï¼‰

1. è¿”å› Worker çš„è¯¦æƒ…é¡µé¢ï¼ˆå¦‚æœè¿˜åœ¨ç¼–è¾‘å™¨ï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„ Worker åå­—è¿”å›ï¼‰ã€‚
2. ç‚¹å‡»é¡¶éƒ¨é€‰é¡¹å¡ **Settings (è®¾ç½®)**ã€‚
3. é€‰æ‹©å·¦ä¾§èœå• **Variables and Secrets (å˜é‡å’Œå¯†é’¥)**ã€‚
4. ç‚¹å‡» **Add (æ·»åŠ )** æŒ‰é’®ã€‚
5. å¡«å†™å¦‚ä¸‹ä¿¡æ¯ï¼š
   - **Variable name (å˜é‡å)**: `BACKEND_URL`
   - **Value (å€¼)**: ä½ çš„åç«¯å®Œæ•´åœ°å€ã€‚
     - *ç¤ºä¾‹ 1 (å¸¦ç«¯å£)*: `http://123.123.123.123:5000`
     - *ç¤ºä¾‹ 2 (HTTPS)*: `https://api.example.com`
     - *ç¤ºä¾‹ 3 (å¸¦å­è·¯å¾„)*: `http://myserver.com/app`
6. ç‚¹å‡» **Save and Deploy (ä¿å­˜å¹¶éƒ¨ç½²)**ã€‚

## ğŸ“ ä½¿ç”¨è¯´æ˜

å‡è®¾ä½ çš„ Worker åŸŸåæ˜¯ `https://my-proxy.user.workers.dev`ï¼Œä½ çš„ `BACKEND_URL` è®¾ç½®ä¸º `http://1.2.3.4:5000`ã€‚

| ç”¨æˆ·è®¿é—® URL                         | å®é™…ä»£ç†è¯·æ±‚                         |
| ------------------------------------ | ------------------------------------ |
| `https://my-proxy.../`               | `http://1.2.3.4:5000/`               |
| `https://my-proxy.../api/users?id=1` | `http://1.2.3.4:5000/api/users?id=1` |

ç”¨æˆ·æ— éœ€åœ¨ URL ä¸­æ·»åŠ ç«¯å£ï¼ŒWorker ä¼šè‡ªåŠ¨å¤„ç†ã€‚

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **Cloudflare ç«¯å£é™åˆ¶**ï¼š Worker å‘å‡ºçš„è¯·æ±‚ (`fetch`) å— Cloudflare æ”¯æŒç«¯å£çš„é™åˆ¶ã€‚
   - **æ”¯æŒçš„ HTTP ç«¯å£**: 80, 8080, 8880, 2052, 2082, 2086, 2095
   - **æ”¯æŒçš„ HTTPS ç«¯å£**: 443, 2053, 2083, 2087, 2096, 8443
   - *å¦‚æœä½ çš„åç«¯ç«¯å£ï¼ˆå¦‚ 5000ï¼‰ä¸åœ¨åˆ—è¡¨ä¸­ï¼Œä¸”è¯¥ Worker æ— æ³•è¿æ¥ï¼Œè¯·å°è¯•æ›´æ”¹åç«¯ç«¯å£è‡³ä¸Šè¿°æ”¯æŒåˆ—è¡¨ä¸­çš„ç«¯å£ã€‚*
2. **SSL/TLS**ï¼š å¦‚æœåç«¯æ˜¯è‡ªç­¾åè¯ä¹¦çš„ HTTPSï¼ŒWorker å¯èƒ½ä¼šæŠ¥é”™ã€‚é€šå¸¸å»ºè®®åç«¯ä½¿ç”¨ HTTPï¼ˆå¦‚æœå®‰å…¨å…è®¸ï¼‰æˆ–è€…æœ‰æ•ˆçš„ SSL è¯ä¹¦ã€‚
3. **è‡ªå®šä¹‰åŸŸå**ï¼š ä½ å¯ä»¥åœ¨ Worker çš„ **Triggers** -> **Custom Domains** ä¸­ç»‘å®šè‡ªå·±çš„åŸŸåï¼Œä»£æ›¿ `workers.dev` åç¼€ã€‚
